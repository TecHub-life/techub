<% compact ||= false %>
<% preferences ||= profile.preferences %>
<% item_kind = showcase_item_kind(item) %>
<% hidden = item.respond_to?(:hidden?) && item.hidden? %>
<% classes = [showcase_style_classes(item), (compact ? "p-4" : "p-5"), "h-full"] %>
<% classes << "hidden opacity-60" if hidden %>
<% data_attrs = {
  controller: "showcase-analytics",
  action: "click->showcase-analytics#track",
  showcase_analytics_event_value: showcase_event_for(item),
  "showcase-analytics-item-id-value": item.id,
  "showcase-analytics-kind-value": item_kind.downcase,
  "showcase-analytics-hidden-value": hidden,
  "showcase-analytics-pinned-value": (item.respond_to?(:pinned?) && item.pinned?),
  "showcase-analytics-style-value": item.respond_to?(:applied_style_variant) ? item.applied_style_variant : nil,
  "showcase-analytics-surface-value": item.respond_to?(:pin_surface) ? item.pin_surface : nil,
  "showcase-analytics-profile-value": profile.login
}.compact %>
<% data_attrs[:hidden_item] = true if hidden %>
<% clickable = ((item.is_a?(ProfileLink) || item.is_a?(ProfileAchievement)) && item.url.present?) %>
<% tag_name = clickable ? :a : :div %>
<% tag_options = { class: classes.join(' '), data: data_attrs } %>
<% if clickable %>
  <% tag_options[:href] = item.url %>
  <% tag_options[:target] = "_blank" %>
  <% tag_options[:rel] = "noopener" %>
<% else %>
  <% tag_options[:tabindex] = 0 %>
  <% tag_options[:role] = "button" %>
<% end %>
<% tag_options[:aria] = { hidden: true } if hidden %>

<%= content_tag tag_name, **tag_options do %>
  <div class="flex items-center justify-between text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-300">
    <span><%= item_kind %></span>
    <div class="flex items-center gap-2">
      <% if item.respond_to?(:pinned?) && item.pinned? %>
        <span class="inline-flex items-center rounded-full border border-yellow-300/80 bg-yellow-200/30 px-2 py-0.5 text-[0.7rem] text-yellow-900">Pinned</span>
      <% end %>
      <% if hidden %>
        <span class="inline-flex items-center rounded-full border border-rose-300/80 bg-rose-100/40 px-2 py-0.5 text-[0.7rem] text-rose-900">Hidden</span>
      <% end %>
    </div>
  </div>

  <div class="mt-2 flex items-start gap-3">
    <% if (icon = showcase_item_icon(item)).present? %>
      <span class="mt-1 inline-flex h-10 w-10 items-center justify-center rounded-full bg-white/30 text-lg text-indigo-700 dark:bg-slate-800 dark:text-indigo-200">
        <%= icon %>
      </span>
    <% end %>
    <div class="flex-1">
      <h4 class="text-base font-semibold text-slate-900 dark:text-slate-50"><%= showcase_item_title(item) %></h4>
      <% if (subtitle = showcase_item_subtitle(item)).present? %>
        <p class="mt-1 text-sm text-slate-600 dark:text-slate-300"><%= subtitle %></p>
      <% end %>
    </div>
  </div>

  <% if item.is_a?(ProfileAchievement) %>
    <% timeline = achievement_timestamp_lines(item, preferences) %>
    <% if timeline.any? %>
      <div class="mt-3 space-y-1 text-xs font-medium text-slate-500 dark:text-slate-400">
        <% timeline.each do |line| %>
          <p><%= line %></p>
        <% end %>
      </div>
    <% end %>
  <% elsif item.is_a?(ProfileExperience) %>
    <p class="mt-3 text-xs font-medium text-slate-500 dark:text-slate-400"><%= experience_range(item) %></p>
    <% if item.profile_experience_skills.any? %>
      <div class="mt-3 flex flex-wrap gap-1.5">
        <% item.profile_experience_skills.first(6).each do |skill| %>
          <span class="rounded-full bg-white/60 px-2 py-0.5 text-[0.7rem] font-semibold text-slate-700 shadow-sm dark:bg-slate-800/70 dark:text-slate-200"><%= skill.name %></span>
        <% end %>
      </div>
    <% end %>
  <% end %>

  <% meta_lines = showcase_item_meta_lines(item, preferences) %>
  <% if meta_lines.any? %>
    <div class="mt-3 space-y-1 text-xs text-slate-600 dark:text-slate-300">
      <% meta_lines.each do |line| %>
        <p><%= line %></p>
      <% end %>
    </div>
  <% end %>

  <% if clickable %>
    <div class="mt-4 inline-flex items-center gap-2 text-xs font-semibold text-indigo-600 dark:text-indigo-300">
      Open link
      <i class="fa-solid fa-arrow-up-right-from-square"></i>
    </div>
  <% end %>
<% end %>
