<% compact ||= false %>
<% preferences ||= profile.preferences %>
<% item_kind = showcase_item_kind(item) %>
<% hidden = item.respond_to?(:hidden?) && item.hidden? %>
<% classes = [showcase_style_classes(item, compact: compact), (compact ? "p-4" : "p-6"), "h-full", "flex flex-col gap-4 group"] %>
<% classes << "hidden opacity-60" if hidden %>
<% data_attrs = {
  controller: "showcase-analytics",
  action: "click->showcase-analytics#track",
  showcase_analytics_event_value: showcase_event_for(item),
  "showcase-analytics-item-id-value": item.id,
  "showcase-analytics-kind-value": item_kind.downcase,
  "showcase-analytics-hidden-value": hidden,
  "showcase-analytics-pinned-value": (item.respond_to?(:pinned?) && item.pinned?),
  "showcase-analytics-style-value": item.respond_to?(:applied_style_variant) ? item.applied_style_variant : nil,
  "showcase-analytics-surface-value": item.respond_to?(:pin_surface) ? item.pin_surface : nil,
  "showcase-analytics-profile-value": profile.login
}.compact %>
<% data_attrs[:hidden_item] = true if hidden %>
<% clickable = ((item.is_a?(ProfileLink) || item.is_a?(ProfileAchievement)) && item.url.present?) %>
<% tag_name = clickable ? :a : :div %>
<% tag_options = { class: classes.join(' '), data: data_attrs } %>
<% if clickable %>
  <% tag_options[:href] = item.url %>
  <% tag_options[:target] = "_blank" %>
  <% tag_options[:rel] = "noopener" %>
<% else %>
  <% tag_options[:tabindex] = 0 %>
  <% tag_options[:role] = "button" %>
<% end %>
<% tag_options[:aria] = { hidden: true } if hidden %>

<%= content_tag tag_name, **tag_options do %>
  <% if (item.respond_to?(:pinned?) && item.pinned?) || hidden %>
    <div class="flex flex-wrap items-center justify-end gap-2 text-[0.65rem] font-semibold uppercase tracking-[0.18em] text-slate-500 dark:text-slate-400">
      <% if item.respond_to?(:pinned?) && item.pinned? %>
        <span class="inline-flex items-center gap-1 rounded-full border border-yellow-300/80 bg-yellow-200/20 px-2 py-0.5 text-yellow-900 dark:border-yellow-300/50 dark:bg-yellow-300/10">Pinned</span>
      <% end %>
      <% if hidden %>
        <span class="inline-flex items-center gap-1 rounded-full border border-rose-300/80 bg-rose-100/30 px-2 py-0.5 text-rose-900 dark:border-rose-400/60 dark:bg-rose-400/10">Hidden</span>
      <% end %>
    </div>
  <% end %>

  <div class="flex flex-col items-center gap-4 text-center sm:flex-row sm:items-center sm:text-left">
    <% if (icon = showcase_item_icon(item)).present? %>
      <span class="inline-flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-2xl bg-white/40 text-2xl text-indigo-700 shadow-sm dark:bg-slate-800/70 dark:text-indigo-200">
        <%= icon %>
      </span>
    <% end %>
    <div class="flex-1 space-y-3">
      <div>
        <h4 class="text-lg font-semibold text-slate-900 dark:text-slate-50"><%= showcase_item_title(item) %></h4>
        <% if (subtitle = showcase_item_subtitle(item)).present? %>
          <p class="mt-1 text-sm text-slate-600 dark:text-slate-300"><%= subtitle %></p>
        <% end %>
      </div>

      <% if item.is_a?(ProfileAchievement) %>
        <% timeline = achievement_timestamp_lines(item, preferences) %>
        <% if timeline.any? %>
          <div class="space-y-1 text-xs font-medium text-slate-500 dark:text-slate-400">
            <% timeline.each do |line| %>
              <p><%= line %></p>
            <% end %>
          </div>
        <% end %>
      <% elsif item.is_a?(ProfileExperience) %>
        <div class="space-y-2 text-xs font-medium text-slate-500 dark:text-slate-400">
          <p><%= experience_range(item) %></p>
          <% if item.profile_experience_skills.any? %>
            <div class="flex flex-wrap justify-center gap-1.5 sm:justify-start">
              <% item.profile_experience_skills.first(6).each do |skill| %>
                <span class="rounded-full bg-white/70 px-2 py-0.5 text-[0.7rem] font-semibold text-slate-700 shadow-sm dark:bg-slate-800/70 dark:text-slate-200"><%= skill.name %></span>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>

      <% meta_lines = showcase_item_meta_lines(item, preferences) %>
      <% if meta_lines.any? %>
        <div class="space-y-1 text-xs text-slate-600 dark:text-slate-300">
          <% meta_lines.each do |line| %>
            <p><%= line %></p>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <% if clickable %>
    <div class="flex items-center justify-center gap-2 text-sm font-semibold text-indigo-600 transition group-hover:text-indigo-700 dark:text-indigo-300 sm:justify-start">
      <span>Visit</span>
      <i class="fa-solid fa-arrow-up-right-from-square"></i>
    </div>
  <% end %>
<% end %>
