<%# 1080x1080 ‚Äì Facebook square post. Background = library art by default. %>
<div class="relative h-[1080px] w-[1080px] overflow-hidden bg-slate-900">
  <% bg_url = @profile.ai_art_opt_in ? nil : supporting_art_url_for(login: @profile.login, aspect: :square) %>
  <% if bg_url.blank? %>
    <% gen = Rails.root.join('public','generated', @profile.login) %>
    <% local = Dir[gen.join('avatar-16x9*.{jpg,jpeg,png}').to_s].first || Dir[gen.join('avatar-3x1*.{jpg,jpeg,png}').to_s].first || Dir[gen.join('card*.{jpg,jpeg,png}').to_s].first || Dir[gen.join('og*.{jpg,jpeg,png}').to_s].first %>
    <% bg_url = "/generated/#{@profile.login}/#{File.basename(local)}" if local %>
  <% end %>
  <% if bg_url.present? %>
    <img src="<%= bg_url %>" alt="background" class="absolute inset-0 h-full w-full object-cover">
  <% else %>
    <div class="absolute inset-0 bg-gradient-to-br from-indigo-700 via-sky-600 to-cyan-500"></div>
  <% end %>
  <div class="absolute inset-0 bg-gradient-to-b from-black/10 via-black/0 to-black/45"></div>
  <div class="absolute bottom-8 left-8 right-8 flex items-end justify-between gap-4">
    <div class="min-w-0">
      <div class="px-3 py-1.5 rounded-md bg-black/55 text-white/95 text-2xl font-bold tracking-wide truncate"><%= @profile.display_name %></div>
      <div class="mt-1 px-2 py-0.5 rounded-md bg-black/45 text-white/90 text-sm inline-block">@<%= @profile.login %></div>
    </div>
    <div class="flex items-center gap-3">
      <% followers = @profile.followers.to_i %>
      <% stars = Array(@profile.top_repositories).sum { |r| r.stargazers_count.to_i } %>
      <span class="px-3 py-1.5 rounded-md bg-black/55 text-white/90 text-sm">‚≠ê <%= stars %></span>
      <span class="px-3 py-1.5 rounded-md bg-black/55 text-white/90 text-sm">üë• <%= followers %></span>
      <div class="h-16 w-16 rounded-full overflow-hidden border-2 border-white/80 shadow-lg">
        <img src="<%= avatar_image_url_for(@profile) %>" alt="avatar" class="h-full w-full object-cover" />
      </div>
    </div>
  </div>
</div>

