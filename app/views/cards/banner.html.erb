<%# 1500x500 banner view used for screenshot capture. 
    Design goals:
    1. Remove redundant avatar (site context already shows it).
    2. Focus on "at a glance" value: flavor text, key stats, tech stack.
    3. Make branding distinct but not overpowering.
    4. Ensure contrast against busy backgrounds.
%>
<section class="relative h-[<%= (@canvas_h || 500).to_i %>px] w-[<%= (@canvas_w || 1500).to_i %>px] overflow-hidden bg-slate-900 font-sans">
  <% card = @profile.profile_card %>
  <%# Prefer library art when AI art is not opted-in %>
  <% if !@profile.ai_art_opt_in %>
    <% bg_url = supporting_art_url_for(profile: @profile, aspect: :banner) %>
  <% else %>
    <%# Background image selection logic... %>
    <% bg_url = nil %>
    <% if (asset = @profile.profile_assets.find_by(kind: 'avatar_3x1')) && asset.public_url.present? %>
      <% bg_url = asset.public_url %>
    <% elsif (asset = @profile.profile_assets.find_by(kind: 'card')) && asset.public_url.present? %>
      <% bg_url = asset.public_url %>
    <% elsif (asset = @profile.profile_assets.find_by(kind: 'og')) && asset.public_url.present? %>
      <% bg_url = asset.public_url %>
    <% else %>
      <% base = Rails.root.join('public','generated', @profile.login) %>
      <% local = Dir[base.join('avatar-3x1*.{jpg,jpeg,png}').to_s].first || Dir[base.join('card*.{jpg,jpeg,png}').to_s].first || Dir[base.join('og*.{jpg,jpeg,png}').to_s].first %>
      <% bg_url = "/generated/#{@profile.login}/#{File.basename(local)}" if local %>
    <% end %>
    <% if bg_url.nil? %>
      <% bg_url = supporting_art_url_for(profile: @profile, aspect: :banner) %>
    <% end %>
  <% end %>

  <% if bg_url.present? %>
    <img src="<%= bg_url %>" alt="banner" class="absolute inset-0 h-full w-full object-cover opacity-40 blur-[2px]" />
  <% else %>
    <div class="absolute inset-0 bg-gradient-to-r from-indigo-900 via-slate-800 to-slate-900 opacity-100"></div>
  <% end %>
  
  <%# Strong gradient overlay for text readability %>
  <div class="absolute inset-0 bg-gradient-to-r from-slate-900/95 via-slate-900/70 to-transparent"></div>

  <div class="absolute inset-0 flex items-center px-16">
    <div class="w-full max-w-4xl">
      <%# Identity Block %>
      <div class="mb-6">
        <h1 class="text-6xl font-black text-white tracking-tight leading-none mb-2 drop-shadow-lg">
          <%= @profile.display_name %>
        </h1>
        <p class="text-3xl font-bold text-indigo-400">@<%= @profile.login %></p>
      </div>

      <%# Flavor/Bio - The "Hook" %>
      <% if (tag = card&.flavor_text.presence || card&.short_bio.presence).present? %>
        <div class="mb-8 max-w-2xl">
          <p class="text-2xl font-medium text-slate-200 leading-snug italic border-l-4 border-indigo-500 pl-4">
            "<%= tag %>"
          </p>
        </div>
      <% end %>

      <%# Tech Stack & Stats - The "Proof" %>
      <div class="flex flex-wrap items-center gap-6 text-lg font-semibold text-slate-300">
        <%# Top Languages %>
        <% top_langs = @profile.profile_languages.order(count: :desc).limit(3).pluck(:name) %>
        <% if top_langs.any? %>
          <div class="flex items-center gap-2">
            <span class="text-indigo-400">Builds with</span>
            <span class="text-white"><%= top_langs.join(" Â· ") %></span>
          </div>
          <span class="text-slate-600">â€¢</span>
        <% end %>

        <%# Key Metrics %>
        <% followers = @profile.followers.to_i %>
        <% stars = Array(@profile.top_repositories).sum { |r| r.stargazers_count.to_i } %>
        
        <div class="flex items-center gap-4">
          <% if stars > 0 %>
             <span class="flex items-center gap-1.5"><span class="text-amber-400">â˜…</span> <%= number_to_human(stars, format: "%n%u", units: { thousand: "K" }) %> Stars</span>
          <% end %>
          <% if followers > 0 %>
             <span class="flex items-center gap-1.5"><span class="text-emerald-400">ðŸ‘¥</span> <%= number_to_human(followers, format: "%n%u", units: { thousand: "K" }) %> Followers</span>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <%# Branding - Visible but anchored %>
  <div class="absolute bottom-6 right-8">
    <div class="flex items-center gap-2 bg-black/40 backdrop-blur-md px-4 py-2 rounded-full border border-white/10">
      <span class="w-3 h-3 rounded-full bg-indigo-500 animate-pulse"></span>
      <span class="text-sm font-bold text-white tracking-widest uppercase">techub.life</span>
    </div>
  </div>
</section>
