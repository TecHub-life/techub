<%# Uploads Tab %>
<div class="space-y-6">
  <div class="rounded-xl border border-slate-200 bg-white p-4 md:p-6 shadow-lg dark:border-slate-700 dark:bg-slate-900">
    <h2 class="text-xl font-bold text-slate-900 dark:text-slate-100 mb-4">Your AI Asset Library</h2>
    <p class="text-sm text-slate-600 dark:text-slate-300 mb-4">Pick a previously generated asset as the active image.</p>

    <% if @profile.present? %>
      <% safe_login = @profile.login.to_s.downcase.gsub(/[^a-z0-9\-]/, "") %>
      <% base = Rails.root.join('public','generated', safe_login) %>
      <% gallery = [] %>
      <% if Dir.exist?(base) %>
        <% exts = %w[.jpg .jpeg .png] %>
        <% Dir.children(base).each do |fn| %>
          <% next unless exts.include?(File.extname(fn).downcase) %>
          <% gallery << base.join(fn).to_s %>
        <% end %>
      <% end %>

      <% if gallery.any? %>
        <div class="grid gap-3 sm:grid-cols-3">
          <% gallery.first(12).each_with_index do |path, index| %>
            <% fname = File.basename(path) %>
            <div class="rounded border border-slate-200 p-2 dark:border-slate-700">
              <img src="<%= "/generated/#{safe_login}/#{fname}" %>" alt="<%= fname %>" class="h-24 w-full object-cover rounded">
              <div class="mt-2 flex items-center justify-between gap-2 text-xs">
                <span class="truncate" title="<%= fname %>"><%= fname %></span>
                <form action="<%= select_my_profile_asset_path(username: @profile.login) %>" method="post" class="flex flex-col gap-2 sm:flex-row sm:items-center" data-controller="submit-form">
                  <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
                  <%= hidden_field_tag :tab, "uploads" %>
                  <input type="hidden" name="local_path" value="<%= path %>">
                  <%= select_tag "kind",
                    options_for_select([
                      ['OG', 'og'],
                      ['OG (Professional)', 'og_pro'],
                      ['Card', 'card'],
                      ['Card (Professional)', 'card_pro'],
                      ['Simple', 'simple'],
                      ['Banner 3×1', 'avatar_3x1'],
                      ['16×9', 'avatar_16x9'],
                      ['1×1', 'avatar_1x1']
                    ]),
                    id: "upload-kind-#{index}",
                    aria: { label: "Asset type" },
                    class: "#{ui_select_class} sm:w-44" %>
                  <button type="submit" class="<%= ui_secondary_button_class %> sm:w-auto" data-submit-form-target="button">
                    <span data-submit-form-target="spinner" class="hidden">
                      <svg class="h-4 w-4 animate-spin" viewBox="0 0 24 24" fill="none">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V2C5.373 2 1 6.373 1 12h3z"></path>
                      </svg>
                    </span>
                    <span data-submit-form-target="text">Use</span>
                  </button>
                </form>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="text-sm text-slate-600 dark:text-slate-300">No generated assets yet. Run the full pipeline to add items.</p>
      <% end %>
    <% else %>
      <p class="text-sm text-slate-600 dark:text-slate-300">Profile not available.</p>
    <% end %>
  </div>
</div>
