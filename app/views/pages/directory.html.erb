<section class="mx-auto max-w-6xl space-y-6 px-4 py-12">
  <div class="flex items-end justify-between gap-4">
    <div class="flex items-center gap-3">
      <h1 class="text-3xl font-bold text-slate-900 dark:text-slate-100">TecHub Directory</h1>
      <a href="<%= motifs_path %>" class="text-sm text-slate-700 hover:text-blue-600 dark:text-slate-300">Browse archetypes & spirits →</a>
      <p class="text-slate-600 dark:text-slate-300">
        Recently generated profiles. Sign in and submit your username to join the list.
      </p>
    </div>
    <form action="<%= directory_path %>" method="get" class="flex flex-wrap gap-2 items-end">
      <input type="text" name="q" value="<%= h @q %>" placeholder="Search @login or name" class="w-64 rounded border border-slate-300 bg-white p-2 text-slate-900 dark:border-slate-600 dark:bg-slate-900 dark:text-slate-100">
      <input type="text" name="tag" value="<%= h @tag %>" placeholder="Tag (e.g., ruby)" class="w-40 rounded border border-slate-300 bg-white p-2 text-slate-900 dark:border-slate-600 dark:bg-slate-900 dark:text-slate-100">
      <input type="text" name="language" value="<%= h @language %>" placeholder="Language" class="w-40 rounded border border-slate-300 bg-white p-2 text-slate-900 dark:border-slate-600 dark:bg-slate-900 dark:text-slate-100">
      <input type="number" name="min_followers" min="0" value="<%= h(@min_followers || '') %>" placeholder="Min followers" class="w-36 rounded border border-slate-300 bg-white p-2 text-slate-900 dark:border-slate-600 dark:bg-slate-900 dark:text-slate-100">
      <label class="inline-flex items-center gap-2 text-sm text-slate-700 dark:text-slate-300"><input type="checkbox" name="hireable" value="1" <%= 'checked' if @hireable %>> Hireable</label>
      <label class="inline-flex items-center gap-2 text-sm text-slate-700 dark:text-slate-300"><input type="checkbox" name="active" value="1" <%= 'checked' if @active %>> Active (30d)</label>
      <label class="inline-flex items-center gap-2 text-sm text-slate-700 dark:text-slate-300"><input type="checkbox" name="mine" value="1" <%= 'checked' if @mine %>> Only mine</label>
      <button class="rounded bg-slate-900 px-4 py-2 text-white dark:bg-slate-100 dark:text-slate-900">Filter</button>
    </form>
  </div>

  <% if @profiles.any? %>
    <% if @tag_cloud.any? %>
      <div class="mb-4 flex flex-wrap gap-2 text-sm">
        <% @tag_cloud.each do |t, count| %>
          <a href="<%= directory_path(tag: t) %>" class="inline-flex items-center gap-1 rounded-full border px-2.5 py-1 text-slate-700 hover:text-blue-600 dark:text-slate-300 dark:border-slate-700 dark:hover:text-blue-400">
            <span>#<%= t %></span>
            <span class="text-slate-500">(<%= count %>)</span>
          </a>
        <% end %>
      </div>
    <% end %>
    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      <% @profiles.each do |profile| %>
        <div class="rounded-xl border border-slate-200 bg-white p-4 shadow-sm transition hover:shadow-md dark:border-slate-700 dark:bg-slate-800">
          <div class="flex items-center gap-3">
            <img src="<%= profile.avatar_url %>" alt="<%= profile.login %>" class="w-12 h-12 rounded-full">
            <div class="min-w-0">
              <a href="<%= profile_path(username: profile.login) %>" class="block truncate font-semibold text-slate-900 hover:text-blue-600 dark:text-slate-100 dark:hover:text-blue-400">
                <%= profile.display_name %>
              </a>
              <div class="text-sm text-slate-600 dark:text-slate-400 truncate">@<%= profile.login %></div>
            </div>
          </div>
          <div class="mt-3 flex items-center justify-between text-sm">
            <div class="text-slate-600 dark:text-slate-400"><%= profile.followers.to_i %> followers</div>
            <div class="flex items-center gap-2">
              <% og_url = nil %>
              <% if (asset = profile.profile_assets.find_by(kind: 'og')) && asset.public_url.present? %>
                <% og_url = asset.public_url %>
              <% else %>
                <% og_url = og_image_url(login: profile.login) %>
              <% end %>
              <a href="<%= og_url %>" target="_blank" class="text-slate-700 hover:text-blue-600 dark:text-slate-300 dark:hover:text-blue-400">OG</a>
              <a href="<%= card_preview_path(login: profile.login) %>" target="_blank" class="text-slate-700 hover:text-blue-600 dark:text-slate-300 dark:hover:text-blue-400">Card</a>
            </div>
          </div>
          <% if (card = profile.profile_card) && Array(card.tags).any? %>
            <div class="mt-3 flex flex-wrap gap-2">
              <% Array(card.tags).first(6).each do |t| %>
                <a href="<%= directory_path(tag: t) %>" class="inline-block rounded-full border px-2.5 py-1 text-xs text-slate-600 hover:text-blue-600 dark:text-slate-300 dark:border-slate-700 dark:hover:text-blue-400">#<%= t %></a>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>

    <div class="mt-6 flex items-center justify-between text-sm">
      <div class="text-slate-600 dark:text-slate-400">
        Showing <%= ((@page - 1) * @per_page) + 1 %>–<%= ((@page - 1) * @per_page) + @profiles.length %> of <%= @total %>
      </div>
      <div class="flex items-center gap-2">
        <% if @has_prev %>
          <%= link_to "← Prev", directory_path(q: @q.presence, page: @page - 1), class: "rounded border px-3 py-1.5 text-slate-700 hover:bg-slate-50 dark:text-slate-300 dark:border-slate-700 dark:hover:bg-slate-800" %>
        <% else %>
          <span class="rounded border px-3 py-1.5 text-slate-400 dark:text-slate-500 dark:border-slate-800">← Prev</span>
        <% end %>
        <% if @has_next %>
          <%= link_to "Next →", directory_path(q: @q.presence, page: @page + 1), class: "rounded border px-3 py-1.5 text-slate-700 hover:bg-slate-50 dark:text-slate-300 dark:border-slate-700 dark:hover:bg-slate-800" %>
        <% else %>
          <span class="rounded border px-3 py-1.5 text-slate-400 dark:text-slate-500 dark:border-slate-800">Next →</span>
        <% end %>
      </div>
    </div>
  <% else %>
    <p class="text-slate-600 dark:text-slate-300">No profiles yet. Submit one to get started.</p>
  <% end %>
</section>
