<section class="mx-auto max-w-5xl space-y-6 px-4 py-12">
  <h1 class="text-2xl font-bold text-slate-900 dark:text-slate-100">Ownerships</h1>
  <p class="text-slate-600 dark:text-slate-300">See who owns each profile and change owners when needed.</p>

  <div class="overflow-x-auto rounded border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800">
    <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
      <thead>
        <tr class="bg-slate-50 dark:bg-slate-900/40 text-left text-sm text-slate-700 dark:text-slate-300">
          <th class="px-4 py-3 font-semibold">Profile</th>
          <th class="px-4 py-3 font-semibold">Owner</th>
          <th class="px-4 py-3 font-semibold">Transfer to</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-200 dark:divide-slate-700">
        <% @profiles_with_links.each do |profile| %>
          <% owner_link = profile.profile_ownerships.find { |po| po.is_owner } %>
          <tr class="text-sm">
            <td class="px-4 py-2">
              <a href="<%= profile_path(username: profile.login) %>" class="text-blue-600 dark:text-blue-400">@<%= profile.login %></a>
            </td>
            <td class="px-4 py-2">
              <% if owner_link %>
                <a href="<%= owner_link.user.github_profile_url %>" target="_blank" rel="noopener" class="text-slate-900 dark:text-slate-100">@<%= owner_link.user.login %></a>
              <% else %>
                â€”
              <% end %>
            </td>
            <td class="px-4 py-2">
              <% if owner_link %>
                <form action="<%= ops_transfer_ownership_path(owner_link.id) %>" method="post" class="flex items-center gap-2">
                  <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
                  <select name="target_login" class="rounded border border-slate-300 bg-white px-2 py-1 text-sm dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100">
                    <option value="" disabled selected>Current owner: @<%= owner_link.user.login %></option>
                    <% @users.each do |u| %>
                      <option value="<%= u.login %>">@<%= u.login %></option>
                    <% end %>
                  </select>
                  <button type="submit" class="rounded bg-indigo-600 px-3 py-1 text-white text-sm hover:bg-indigo-700">Transfer</button>
                </form>
              <% else %>
                <form action="<%= ops_set_owner_ownership_path %>" method="post" class="flex items-center gap-2">
                  <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
                  <input type="hidden" name="profile_login" value="<%= profile.login %>" />
                  <select name="target_login" class="rounded border border-slate-300 bg-white px-2 py-1 text-sm dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100">
                    <% @users.each do |u| %>
                      <option value="<%= u.login %>">@<%= u.login %></option>
                    <% end %>
                  </select>
                  <button type="submit" class="rounded bg-indigo-600 px-3 py-1 text-white text-sm hover:bg-indigo-700">Set owner</button>
                </form>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <div>
    <%= link_to 'Back to Ops', ops_admin_path, class: 'inline-block text-slate-700 hover:text-blue-600 dark:text-slate-300' %>
  </div>
</section>
