<header class="safe-y fixed inset-x-0 top-0 z-50 border-b border-slate-200 bg-white/85 backdrop-blur-lg transition dark:border-slate-800 dark:bg-slate-950/85">
  <div class="mx-auto flex max-w-screen-xl items-center justify-between gap-4 px-4 py-3 sm:px-6 lg:px-8">
    <%= link_to root_path, class: "flex items-center gap-2 text-base font-semibold text-slate-900 dark:text-slate-100" do %>
      <%= image_tag "/techub-icon.svg", alt: "TecHub", class: "h-8 w-8 flex-shrink-0 transition dark:invert" %>
      <span class="hidden sm:inline">TecHub</span>
    <% end %>

    <nav class="hidden items-center gap-2 text-sm font-medium text-slate-600 dark:text-slate-300 lg:flex">
      <%= nav_link_with_icon "Directory", directory_path, "fa-solid fa-folder-open" %>
      <%= nav_link_with_icon "Leaderboards", leaderboards_path, "fa-solid fa-trophy" %>
      <%= nav_link_with_icon "Analytics", analytics_path, "fa-solid fa-chart-line" %>
      <%= nav_link_with_icon "FAQ", faq_path, "fa-solid fa-circle-question" %>
      <%= nav_link_with_icon "Submit", submit_path, "fa-solid fa-paper-plane", data: { turbo: false } %>
      <% if current_user %>
        <%= nav_link_with_icon "My Profiles", my_profiles_path, "fa-solid fa-id-badge" %>
      <% end %>
      <details class="group relative header-more">
        <summary class="flex cursor-pointer items-center gap-2 rounded-full px-3 py-2 transition-colors duration-150 hover:text-slate-900 dark:hover:text-slate-100">
          <i class="fa-solid fa-ellipsis text-base"></i>
          <span>More</span>
        </summary>
        <div class="absolute right-0 mt-2 w-48 rounded-lg border border-slate-200 bg-white py-2 shadow-lg dark:border-slate-700 dark:bg-slate-900">
          <%= nav_dropdown_link "API Docs", api_docs_path, "fa-solid fa-book-open", active: request.path.start_with?(api_docs_path) %>
          <%= nav_dropdown_link "GitHub", "https://github.com/loftwah/techub", "fa-brands fa-github", target: "_blank", rel: "noopener" %>
        </div>
      </details>
    </nav>

    <div class="flex items-center gap-2">
      <button
        type="button"
        class="inline-flex h-10 w-10 items-center justify-center rounded-full border border-slate-200 bg-white text-slate-700 shadow-sm transition hover:border-slate-300 hover:bg-slate-100 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-300 dark:hover:border-slate-600 dark:hover:bg-slate-800 lg:hidden"
        aria-controls="mobile-menu"
        aria-expanded="false"
        id="mobile-menu-button"
        aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>

      <button
        class="inline-flex h-10 w-10 items-center justify-center rounded-full border border-slate-200 bg-white text-slate-700 shadow-sm transition hover:border-slate-300 hover:bg-slate-100 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-300 dark:hover:border-slate-600 dark:hover:bg-slate-800"
        data-action="theme#toggle"
        data-theme-target="button"
        type="button">
        <span data-theme-target="icon" aria-hidden="true">ðŸŒ—</span>
        <span class="sr-only">Toggle theme</span>
      </button>

      <% if current_user %>
        <%= link_to session_path, data: { turbo_method: :delete }, class: "hidden lg:inline-flex h-10 items-center justify-center gap-2 rounded-full border border-slate-200 px-4 text-sm font-medium text-slate-700 shadow-sm transition hover:border-slate-300 hover:bg-slate-100 dark:border-slate-700 dark:text-slate-200 dark:hover:border-slate-600 dark:hover:bg-slate-800" do %>
          <i class="fa-solid fa-arrow-right-from-bracket text-base"></i>
          <span>Sign out</span>
        <% end %>
      <% else %>
        <%= link_to login_path, class: "hidden lg:inline-flex h-10 items-center justify-center gap-2 rounded-full border border-slate-200 px-4 text-sm font-medium text-slate-700 shadow-sm transition hover:border-slate-300 hover:bg-slate-100 dark:border-slate-700 dark:text-slate-200 dark:hover:border-slate-600 dark:hover:bg-slate-800" do %>
          <i class="fa-solid fa-right-to-bracket text-base"></i>
          <span>Login</span>
        <% end %>
      <% end %>
    </div>
  </div>

  <nav id="mobile-menu" class="hidden border-t border-slate-200 bg-white/95 px-4 pb-4 pt-3 text-sm font-medium text-slate-700 dark:border-slate-800 dark:bg-slate-950/85 dark:text-slate-200 lg:hidden">
    <div class="mx-auto flex max-w-screen-xl flex-col gap-1">
      <%= mobile_nav_link "Directory", directory_path, icon: "fa-solid fa-folder-open" %>
      <%= mobile_nav_link "Leaderboards", leaderboards_path, icon: "fa-solid fa-trophy" %>
      <%= mobile_nav_link "Analytics", analytics_path, icon: "fa-solid fa-chart-line" %>
      <%= mobile_nav_link "FAQ", faq_path, icon: "fa-solid fa-circle-question" %>
      <%= mobile_nav_link "Submit", submit_path, icon: "fa-solid fa-paper-plane", data: { turbo: false } %>
      <% if current_user %>
        <%= mobile_nav_link "My Profiles", my_profiles_path, icon: "fa-solid fa-id-badge" %>
        <%= mobile_nav_link "Sign out", session_path, icon: "fa-solid fa-arrow-right-from-bracket", data: { turbo_method: :delete } %>
      <% else %>
        <%= mobile_nav_link "Login", login_path, icon: "fa-solid fa-right-to-bracket" %>
      <% end %>
      <div class="mt-3 border-t border-slate-200 pt-3 dark:border-slate-700">
        <p class="mb-2 text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">More</p>
        <%= mobile_nav_link "API Docs", api_docs_path, icon: "fa-solid fa-book-open", active: request.path.start_with?(api_docs_path) %>
        <%= mobile_nav_link "GitHub", "https://github.com/loftwah/techub", icon: "fa-brands fa-github", target: "_blank", rel: "noopener" %>
      </div>
    </div>
  </nav>
</header>

<script>
  ;(() => {
    const button = document.getElementById('mobile-menu-button')
    const menu = document.getElementById('mobile-menu')
    if (!button || !menu) return

    button.addEventListener('click', () => {
      const expanded = button.getAttribute('aria-expanded') === 'true'
      button.setAttribute('aria-expanded', String(!expanded))
      menu.classList.toggle('hidden')
    })

    document.addEventListener('turbo:before-cache', () => {
      button.setAttribute('aria-expanded', 'false')
      menu.classList.add('hidden')
    })
  })()
</script>
